<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>FastId3 lib test</title>
    <link rel="stylesheet" href="bulma.css">
    <style>
        #time:not(:empty)::before {
            content: "Computed in "
        }
    </style>
</head>
<body>
    <section class="section" style="padding: .5rem 1.5rem ">
        <div class="container" style="text-align: center">
            <input type="file" id="input" style="display:none">
            <div class="button is-primary" onclick="this.parentElement.children[0].click()">Upload a song</div>
        </div>
    </section>
    <section class="section" style="padding: .5rem 1.5rem ">
        <div class="container" style="text-align: center">
            <div class="card" style="max-width: 400px; margin: auto">
            <div class="card-image">
                <figure class="image">
                <img src="1280x960.png" id="img" alt="Image">
                </figure>
            </div>
            <div class="card-content columns">
                <div class="media-content column">
                    <p class="title is-4" id="title">Song Title</p>
                    <p class="subtitle is-6" id="album">Album</p>
                    <p class="subtitle is-6" style="margin-top: -1.5em" id="track">Track</p>
                </div>
                <div class="media-content column" style="text-align: right">
                    <p class="title is-4" id="artist">Artist</p>
                    <p class="subtitle is-6" id="year">Year</p>
                    <p class="subtitle is-6" style="margin-top: -1.5em" id="genre">Genre</p>
                </div>
                
            </div>
            <footer class="card-footer">
                <audio class="card-footer-item" controls style="width:100%" id="audio"></audio>
            </footer>
        </div>
        <div>
            <span class="" id="time" style=""></span>            
        </div>        
    </section>
    <div id="div"></div>
    <img src="" >
</body>
<script src="FID3.min.js"></script>
<script>
    var fileIn = document.querySelector ("#input")
    var img = document.querySelector ("#img")
    var artist = document.querySelector ("#artist")
    var album = document.querySelector ("#album")
    var title = document.querySelector ("#title")
    var track = document.querySelector ("#track")
    var genre = document.querySelector ("#genre")
    var year = document.querySelector ("#year")
    var audio = document.querySelector ("#audio")
    var time = document.querySelector ("#time")
    fileIn.addEventListener("change", function(e) {
            var file = e.target.files[0]
            var t1 = Date.now()            
            FID3(file).then(tag => {
                console.log(tag)
                Promise.all(tag.frames.map(e => e.read())).then(r => {
                    time.innerText = Date.now() - t1 + "ms"
                    album.innerText = !!tag.album ? tag.album.value : "Unknown album"
                    title.innerText = !!tag.title ? tag.title.value : "Unknown title"
                    year.innerText = !!tag.year ? tag.year.value : "Unknown year"
                    track.innerText = !!tag.track ? tag.track.value : "Unknown track"
                    genre.innerText = !!tag.genre ? tag.genre.value : "Unknown genre"
                    artist.innerText = !!tag.artist ? tag.artist.value : "Unknown artist"
                    img.src = !!tag.picture ? window.URL.createObjectURL(tag.picture.value) : "1280x960.png"
                    audio.src = window.URL.createObjectURL(file)
                });
            })
        })
</script>
</html>